# 教学楼室内导航系统

一个基于 Python 后端和微信小程序前端的室内导航系统，专为教学楼环境设计。系统提供语音交互、3D 导航可视化、拥堵感知和智能路径规划等功能。

## 系统架构

### 前端 (微信小程序)

前端使用微信小程序技术栈 (WXML/WXSS/JavaScript) 开发，主要模块包括：

1. **首页/唤醒界面**：显示教学楼名称、导航入口按钮，支持语音唤醒
2. **语音交互模块**：实现语音转文字和文字转语音功能
3. **目的地选择模块**：支持语音输入和手动选择目的地
4. **3D 导航可视化模块**：显示教学楼 3D 模型和导航路线
5. **实时路线提示模块**：提供文字和语音导航指令，显示拥堵状态
6. **设置模块**：管理用户偏好设置、历史记录和收藏目的地

### 后端 (Python)

后端使用 Python 开发，部署为微信云函数，主要模块包括：

1. **用户指令解析模块**：解析用户的语音/文字导航指令
2. **路径计算模块**：基于 A* 算法的最优路径计算（从 C++ 转译）
3. **拥堵率获取与处理模块**：处理手机加速度传感器数据，计算路段拥堵率
4. **3D 模型与路径匹配模块**：将导航路径坐标与 3D 模型匹配
5. **数据存储模块**：管理建筑、路径、用户和拥堵数据
6. **API 对接与调度模块**：对接语音 API 和拥堵率 API

## 功能特点

- **语音交互**：支持"小导小导"等唤醒词，语音输入目的地，语音播报导航指令
- **智能路径规划**：考虑距离和拥堵情况，计算最优路线
- **3D 可视化导航**：在 3D 建筑模型上显示导航路线，支持缩放和旋转
- **拥堵感知**：利用手机加速度传感器数据实时检测路段拥堵情况
- **个性化设置**：支持调节语音播报音量、设置唤醒词、收藏常用目的地

## 技术实现

### 前端技术

- 微信小程序框架
- 小程序云开发
- Three.js 小程序版（3D 渲染）

### 后端技术

- Python 3.8+
- A* 路径算法（从 C++ 转译）
- 云函数部署
- 百度/腾讯云语音 API

### 数据存储

- 微信云数据库
- 建筑信息、导航节点、用户数据、拥堵数据等

## 系统流程

1. 用户打开小程序，通过语音或手动选择目的地
2. 后端解析用户指令，获取当前位置和目的地
3. 后端计算最优路径，考虑距离和拥堵情况
4. 前端加载 3D 模型，显示导航路线
5. 用户按照语音和文字指令进行导航
6. 系统实时收集拥堵数据，必要时重新规划路线

## 部署说明

### 前端部署

1. 在微信开发者工具中导入 `frontend` 目录
2. 配置小程序 AppID 和云开发环境
3. 上传并部署云函数

### 后端部署

1. 在微信云开发控制台创建云函数
2. 上传 `backend` 目录下的各个模块
3. 配置云函数触发器和权限

### 第三方 API 配置

在 `backend/api/voice_api.py` 中配置语音 API 的密钥：

```python
VOICE_API_CONFIG = {
    'baidu': {
        'app_id': 'YOUR_BAIDU_APP_ID',
        'api_key': 'YOUR_BAIDU_API_KEY',
        'secret_key': 'YOUR_BAIDU_SECRET_KEY',
        # ...
    },
    'tencent': {
        'app_id': 'YOUR_TENCENT_APP_ID',
        'app_key': 'YOUR_TENCENT_APP_KEY',
        # ...
    }
}
```

## 未来扩展

- 增加室内定位功能，提高导航精度
- 支持多建筑导航和室外-室内无缝衔接
- 添加 AR 导航视图，增强现实感
- 接入更多传感器数据，提高拥堵预测准确性
- 支持多语言导航指令
